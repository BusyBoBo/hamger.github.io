<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>互换拼图</title>
    <script type="text/javascript" src="zepto.js"></script>
    <style>
        ul , li {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        #gameBox {
            width: 300px;
            height: 300px;
            margin: 30 auto;
        }
        #gameBox li {
            width: 100px;
            height: 100px;
            display: inline-block;
        }
    </style>
</head>

<body>
    <div class="game-box">
        <ul id="gameBox">
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
            <li><img src="" alt=""></li>
        </ul>
    </div>
    <canvas id="canvas" style="display: none" width="300" height="300"></canvas>
    <script>


    function randomSort(arr, newArr) {
        if (arr.length == 1) {
            newArr.push(arr[0]);
            return newArr;
        }
        var random = Math.floor(Math.random() * arr.length);
        newArr.push(arr[random]);
        arr.splice(random, 1);
        return randomSort(arr, newArr);
    }
    var arr = [0, 1, 2]
    var arrx = []
    var arry = []
    arrx = randomSort(arr, arrx)
    arry = randomSort(arr, arry)
    var oriArr = [1, 2, 3, 4, 5, 6, 7, 8, 9];
    var imgArr = [];
    var $lis = $('#gameBox li')
    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d')
    var image = new Image();


    var App = {
        start: function() {
            this.init();
            this.render();
            this.bind();
        },
        init: function() {
            imgArr = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            this.render();
        },
        render: function() {
            image.onload = function() {
                App.randomImage();
            }
            image.src = 'pic.jpg';
        },
        randomImage: function() {
            var index = 1;
            for (var i = 0; i < 3; i++) {
                for (var j = 0; j < 3; j++) {
                    ctx.drawImage(image, 100 * arrx[j], 100 * arry[i], 300, 300, 0, 0, 300, 300);
                    $lis.eq(imgArr[index - 1] - 1).find('img').data('seq', index).attr('src', canvas.toDataURL('image/jpeg'));
                    index++;
                }
            }
        },
        bind: function() {
            //阻止手机上浏览器的弹性下拉。。。
            $('body').on('touchstart', function(e) {
                e.preventDefault();
            });
            $lis.on('swipeLeft', function(e) {
                e.preventDefault();
                var $this = $(this);
                var index = $this.index();
                var html = $this.html();
                var $prev = $this.prev();
                if ($.inArray(index, [3, 6]) > -1 || $prev.size() <= 0) {
                    return false;
                }
                $this.html($prev.html());
                $prev.html(html);
                App.check();
            });
            $lis.on('swipeRight', function(e) {
                e.preventDefault();
                var $this = $(this);
                var index = $this.index();
                var html = $this.html();
                var $next = $this.next();
                if ($.inArray(index, [2, 5]) > -1 || $next.size() <= 0) {
                    return false;
                }
                $this.html($next.html());
                $next.html(html);
                App.check();
            });
            $lis.on('swipeUp', function(e) {
                e.preventDefault();
                var $this = $(this);
                var html = $this.html();
                var index = $this.index() - 3;
                var $up = $lis.eq(index);
                if (index >= 0 && $up.size() > 0) {
                    $this.html($up.html());
                    $up.html(html);
                    App.check();
                }
            });
            $lis.on('swipeDown', function(e) {
                e.preventDefault();
                var $this = $(this);
                var html = $this.html();
                var index = $this.index() + 3;
                var $down = $lis.eq(index);
                if (index < 9 && $down.size() > 0) {
                    $this.html($down.html());
                    $down.html(html);
                    App.check();
                }
            });
        },
        check: function() {
                var resArr = [];
                $('#gameBox img').each(function(k, v) {
                    resArr.push(v.getAttribute("data-seq"));
                });
                if (resArr.join("") === oriArr.join("")) {
                    alert('拼图完成，真聪明！');
                }
            },
    }

    App.start()
    </script>
</body>

</html>
